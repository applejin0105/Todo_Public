<mah:MetroWindow
        x:Class="Todo.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Todo"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:tb="http://www.hardcodet.net/taskbar"
                 
        xmlns:viewmodels="clr-namespace:Todo.ViewModels"
        xmlns:models="clr-namespace:Todo.Models"
        xmlns:converters="clr-namespace:Todo.Converters"
        xmlns:helpers="clr-namespace:Todo.Helpers"
                 
        mc:Ignorable="d"
                 
        Title="ToDo" Height="700" Width="900"
        FontFamily="/Resources/#D2Coding"
        WindowTitleBrush="{DynamicResource SecondaryBackgroundColor}"
        GlowBrush="Transparent">

    <Window.Resources>
        <converters:UtcToLocalTimeConverter x:Key="UtcDateConverter"/>
    </Window.Resources>

    <Grid Margin="10" Background="{DynamicResource PrimaryBackgroundColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <WrapPanel Grid.Row="0" Grid.Column="0">
                <TextBox Text="{Binding NewItemTitle}" ToolTip="Title" MinWidth="150" Margin="5"/>
                <ComboBox x:Name="PlatformComboBox" ToolTip="Platform" MinWidth="100" Margin="5" ItemsSource="{Binding AllPlatforms}" DisplayMemberPath="Name"/>
                <DatePicker x:Name="StartDatePicker" ToolTip="Start Date" MinWidth="120" Margin="5" mah:TextBoxHelper.Watermark="yyyy/MM/dd"/>
                <TextBox x:Name="StartTimeTextBox" ToolTip="Start Time" Width="60" Margin="0,5,5,5" mah:TextBoxHelper.Watermark="HH:mm"/>
                <DatePicker x:Name="DueDatePicker" ToolTip="Deadline" MinWidth="120" Margin="5" mah:TextBoxHelper.Watermark="yyyy/MM/dd"/>
                <TextBox x:Name="DueTimeTextBox" ToolTip="Closing Time" Width="60" Margin="0,5,5,5" mah:TextBoxHelper.Watermark="HH:mm"/>
            </WrapPanel>

            <Button Grid.Row="0" Grid.Column="1" Content="Add" Width="80" Margin="5" Click="AddButton_Click" HorizontalAlignment="Right"/>

            <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,5,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Content="Sort by Deadline" Margin="5" Click="SortByDueDate_Click"/>
                <Button Grid.Column="1" Content="Sort by Start Date" Margin="5" Click="SortByStartDate_Click"/>
                <Button Grid.Column="2" Content="Platform Management" Margin="5" Click="PlatformManagementButton_Click"/>
                <Button Grid.Column="4" Content="Settings" Margin="5" Click="SettingsButton_Click"/>
            </Grid>
        </Grid>

        <mah:MetroTabControl x:Name="MainTabControl" Grid.Row="1" Style="{DynamicResource MahApps.Styles.TabControl.Animated}">
            <mah:MetroTabControl.Resources>
                <Style x:Key="TabHeaderTextStyle" TargetType="TextBlock">
                    <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Gray5}"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=mah:MetroTabItem}}" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Accent}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </mah:MetroTabControl.Resources>

            <mah:MetroTabItem>
                <mah:MetroTabItem.Header>
                    <TextBlock Style="{StaticResource TabHeaderTextStyle}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Not Started ({0})">
                                <Binding Path="NotStartedItems.Count" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </mah:MetroTabItem.Header>
                <ListView ItemsSource="{Binding NotStartedItems}" HorizontalContentAlignment="Stretch">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding Title}" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding Platform.Name}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding StartDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="3" Text="{Binding DueDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <ComboBox Grid.Column="4" ItemsSource="{Binding Source={helpers:EnumBindingSource EnumType={x:Type models:WorkStatus}}}" SelectedValue="{Binding Status}" SelectionChanged="StatusComboBox_SelectionChanged" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button Content="Edit" Click="EditButton_Click" Margin="0,0,5,0" Focusable="False"/>
                                    <Button Content="Delete" Click="DeleteButton_Click" Focusable="False"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </mah:MetroTabItem>

            <mah:MetroTabItem>
                <mah:MetroTabItem.Header>
                    <TextBlock Style="{StaticResource TabHeaderTextStyle}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="In Progress ({0})">
                                <Binding Path="InProgressItems.Count" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </mah:MetroTabItem.Header>
                <ListView ItemsSource="{Binding InProgressItems}" HorizontalContentAlignment="Stretch">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding Title}" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding Platform.Name}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding StartDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="3" Text="{Binding DueDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <ComboBox Grid.Column="4" ItemsSource="{Binding Source={helpers:EnumBindingSource EnumType={x:Type models:WorkStatus}}}" SelectedValue="{Binding Status}" SelectionChanged="StatusComboBox_SelectionChanged" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                                    <Button Content="Edit" Click="EditButton_Click" Margin="0,0,5,0" Focusable="False"/>
                                    <Button Content="Delete" Click="DeleteButton_Click" Focusable="False"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </mah:MetroTabItem>

            <mah:MetroTabItem>
                <mah:MetroTabItem.Header>
                    <TextBlock Style="{StaticResource TabHeaderTextStyle}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Completed ({0})">
                                <Binding Path="CompletedItems.Count" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </mah:MetroTabItem.Header>
                <ListView ItemsSource="{Binding CompletedItems}" HorizontalContentAlignment="Stretch">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding Title}" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding Platform.Name}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding StartDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="3" Text="{Binding DueDate, Converter={StaticResource UtcDateConverter}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <ComboBox Grid.Column="4" ItemsSource="{Binding Source={helpers:EnumBindingSource EnumType={x:Type models:WorkStatus}}}" SelectedValue="{Binding Status}" SelectionChanged="StatusComboBox_SelectionChanged" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button Content="Edit" Click="EditButton_Click" Margin="0,0,5,0" Focusable="False"/>
                                    <Button Content="Delete" Click="DeleteButton_Click" Focusable="False"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </mah:MetroTabItem>
        </mah:MetroTabControl>

        <tb:TaskbarIcon
        x:Name="MyNotifyIcon"
        IconSource="/Resources/app_icon.ico"
        ToolTipText="Todo List"
        TrayMouseDoubleClick="MyNotifyIcon_TrayMouseDoubleClick">

            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Open" Click="ShowWindow_Click" />
                    <MenuItem Header="Exit" Click="ExitApplication_Click" />
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

    </Grid>
</mah:MetroWindow>